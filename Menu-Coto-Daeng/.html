<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Coto Makassar Daeng ‚Äì Menu</title>
  <meta name="description" content="Menu resmi Coto Makassar Daeng"/>
  <style>
    :root {
      --bg: #0a0a0a;
      --card: #111111;
      --text: #f5f5f5;
      --muted: #a3a3a3;
      --line: #1f1f1f;
      --radius: 20px;
      --gap: 14px;
    }
    @media (prefers-color-scheme: light) {
      :root {
        --bg: #fafafa;
        --card: #ffffff;
        --text: #111111;
        --muted: #6b7280;
        --line: #e5e7eb;
      }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family: ui-sans-serif, -apple-system, system-ui, Segoe UI, Roboto, Inter, 'Helvetica Neue', Arial; background:var(--bg); color:var(--text);}
    .wrap{max-width: 1040px; margin: 0 auto; padding: 20px;}
    header{position: sticky; top:0; z-index:10; backdrop-filter: blur(6px); background: color-mix(in srgb, var(--bg) 80%, transparent); border-bottom:1px solid var(--line);}
    header .inner{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:14px 0;}
    h1{font-size:18px; margin:0; letter-spacing:0.2px;}
    .head-tools{display:flex; align-items:center; gap:10px; flex-wrap:wrap;}
    input, select{font-size:14px; padding:12px 14px; border-radius: 999px; border:1px solid var(--line); background:transparent; color:var(--text); outline:none; min-width: 220px;}
    input::placeholder{color:var(--muted)}
    .grid{display:grid; grid-template-columns: repeat(auto-fill, minmax(240px,1fr)); gap: var(--gap);}
    .section{margin: 22px 0 28px;}
    .section h2{margin: 12px 4px; font-size: 14px; font-weight: 600; color: var(--muted); letter-spacing: 0.3px;}
    .card{background:var(--card); border:1px solid var(--line); border-radius: var(--radius); overflow:hidden; display:flex; flex-direction:column; transition: transform .15s ease, box-shadow .15s ease;}
    .card:hover{transform: translateY(-2px); box-shadow: 0 10px 24px rgba(0,0,0,.12);}
    .thumb{aspect-ratio: 4/3; width:100%; background: #0f0f10; display:grid; place-items:center; color:#525252;}
    .thumb img{width:100%; height:100%; object-fit: cover; display:block;}
    .content{padding:14px; display:grid; gap:8px;}
    .price{font-weight: 800; font-size: 16px; letter-spacing: .2px;}
    .desc{font-size: 13px; color: var(--muted); line-height: 1.5; min-height: 2.2em;}
    .avail{font-size: 12px; letter-spacing:.3px; padding:6px 10px; width: fit-content; border-radius: 999px; border:1px solid var(--line);}
    .avail.ok{color:#10b981; border-color: #134e4a;}
    .avail.off{color:#ef4444; border-color: #7f1d1d;}
    .footer{margin: 28px 0; color: var(--muted); font-size: 12px; text-align:center;}
    .pill{display:inline-flex; align-items:center; gap:6px; padding:8px 12px; border-radius: 999px; border:1px solid var(--line); color: var(--text); text-decoration:none;}
    a{color:inherit}
  </style>
</head>
<body>
  <header>
    <div class="wrap inner">
      <h1 id="site-title">Coto Makassar Daeng</h1>
      <div class="head-tools">
        <input id="search" placeholder="Cari deskripsi..."/>
        <select id="catFilter"><option value="">Semua Kategori</option></select>
        <a class="pill" href="qr.html" title="Cetak QR">üì± QR</a>
        <a class="pill" href="editor.html" title="Edit menu (offline)">‚úèÔ∏è Editor</a>
      </div>
    </div>
  </header>

  <div class="wrap">
    <div id="root"></div>
    <div class="footer">¬© <span id="year"></span> <span id="foot-name">Coto Makassar Daeng</span></div>
  </div>

  <script>
    const rupiah = (n) => new Intl.NumberFormat('id-ID', { style:'currency', currency:'IDR', maximumFractionDigits:0 }).format(n||0);
    let DATA = null;

    async function load() {
      const res = await fetch('menu.json', { cache: 'no-store' });
      DATA = await res.json();
      document.getElementById('site-title').textContent = DATA.restaurant || 'Menu';
      document.getElementById('foot-name').textContent = DATA.restaurant || 'Menu';
      document.getElementById('year').textContent = new Date().getFullYear();
      const catSelect = document.getElementById('catFilter');
      (DATA.categories||[]).forEach(c=>{
        const opt = document.createElement('option');
        opt.value = c.id; opt.textContent = c.name; catSelect.appendChild(opt);
      });
      document.getElementById('search').addEventListener('input', render);
      catSelect.addEventListener('change', render);
      render();
    }

    function render(){
      const root = document.getElementById('root');
      const q = document.getElementById('search').value.toLowerCase();
      const cat = document.getElementById('catFilter').value;
      const cats = DATA.categories || [];
      const items = (DATA.items||[])
        .filter(it => cat ? it.categoryId === cat : true)
        .filter(it => q ? (it.description||'').toLowerCase().includes(q) : true);

      const byCat = new Map();
      cats.forEach(c => byCat.set(c.id, { cat: c, items: [] }));
      items.forEach(it => { const g = byCat.get(it.categoryId); if (g) g.items.push(it); });

      root.innerHTML = '';
      for (const g of byCat.values()) {
        if (g.items.length === 0) continue;
        const sec = document.createElement('section');
        sec.className = 'section';
        sec.innerHTML = '<h2>'+g.cat.name+'</h2><div class="grid"></div>';
        const grid = sec.querySelector('.grid');
        g.items.forEach(it => grid.appendChild(card(it)));
        root.appendChild(sec);
      }

      if (!root.children.length) {
        root.innerHTML = '<div class="desc">Belum ada item untuk filter/kata kunci tersebut.</div>';
      }
    }

    function card(it){
      const el = document.createElement('article');
      el.className = 'card';
      el.innerHTML = `
        <div class="thumb">
          ${it.image ? `<img src="${it.image}" alt="${it.description || 'Foto menu'}"/>` : '‚Äî'}
        </div>
        <div class="content">
          <div class="price">${rupiah(it.priceIdr)}</div>
          ${it.description ? `<div class="desc">${it.description}</div>` : '<div class="desc">¬†</div>'}
          <div class="avail ${it.available ? 'ok' : 'off'}">${it.available ? 'Tersedia' : 'Habis'}</div>
        </div>
      `;
      return el;
    }

    load();
  </script>
</body>
</html>
